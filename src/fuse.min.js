/**
 * @license
 * Fuse - Lightweight fuzzy-search
 *
 * Copyright (c) 2012-2016 Kirollos Risk <kirollos@gmail.com>.
 * All Rights Reserved. Apache Software License 2.0
 *
 * Licensed under the Apache License, Version 2.0 (the "License")
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t){"use strict";function e(){console.log.apply(null,arguments)}function s(t,e){this.list=t,this.options=e=e||{};var s,o,i,n;for(s=0,n=["sort","shouldSort","verbose"],o=n.length;o>s;s++)i=n[s],this.options[i]=i in e?e[i]:r[i];for(s=0,n=["searchFn","sortFn","keys","getFn","include"],o=n.length;o>s;s++)i=n[s],this.options[i]=e[i]||r[i]}function o(t,e,s){var n,r,h,a,p,c;if(e){if(h=e.indexOf("."),-1!==h?(n=e.slice(0,h),r=e.slice(h+1)):n=e,a=t[n])if(r||"string"!=typeof a&&"number"!=typeof a)if(i(a))for(p=0,c=a.length;c>p;p++)o(a[p],r,s);else r&&o(a,r,s);else s.push(a)}else s.push(t);return s}function i(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t,e){if(e=e||{},this.options=e,this.options.location=e.location||n.defaultOptions.location,this.options.distance="distance"in e?e.distance:n.defaultOptions.distance,this.options.threshold="threshold"in e?e.threshold:n.defaultOptions.threshold,this.options.maxPatternLength=e.maxPatternLength||n.defaultOptions.maxPatternLength,this.pattern=e.caseSensitive?t:t.toLowerCase(),this.patternLen=t.length,this.patternLen>this.options.maxPatternLength)throw new Error("Pattern length is too long");this.matchmask=1<<this.patternLen-1,this.patternAlphabet=this._calculatePatternAlphabet()}var r={id:null,caseSensitive:!1,include:[],shouldSort:!0,searchFn:n,sortFn:function(t,e){return t.score-e.score},getFn:o,keys:[],verbose:!1};s.VERSION="2.0.0",s.prototype.set=function(t){return this.list=t,t},s.prototype.search=function(t){this.options.verbose&&e("=====================\n","Search term:",t),this.pattern=t,this.results=[],this.resultMap={},this._prepare(),this._start(),this._computeScore(),this._sort();var s=this._format();return s},s.prototype._prepare=function(){var t=this.pattern,e=this.options.searchFn,s=t.split(/ +/g);this.tokenSearchers=[];for(var o=0;o<s.length;o++)this.tokenSearchers.push(new e(s[o],this.options));this.mainSeacher=new e(t,this.options)},s.prototype._start=function(){var t,e,s=this.options,o=s.getFn,i=this.list,n=i.length,r=this.options.keys,h=r.length,a=null;if("string"==typeof i[0])for(t=0;n>t;t++)this._analyze(i[t],t,t);else for(t=0;n>t;t++)for(a=i[t],e=0;h>e;e++)this._analyze(o(a,r[e],[]),a,t)},s.prototype._analyze=function(t,s,o){{var n,r,h,a,p,c,l,u,f,d,g,v,m,y=!1,b=this.tokenSearchers;b.length}if(void 0!==t&&null!==t)if(r=[],"string"==typeof t){for(this.options.verbose&&e("---------\n","Record:",n),n=t.split(/ +/g),v=0;v<this.tokenSearchers.length;v++){for(u=this.tokenSearchers[v],f=[],m=0;m<n.length;m++)d=n[m],g=u.search(d),g.isMatch?(y=!0,f.push(g.score),r.push(g.score)):(f.push(1),r.push(1));this.options.verbose&&e('Score for "'+u.pattern+'":',f)}for(a=r[0],c=r.length,v=1;c>v;v++)a+=r[v];a/=c,this.options.verbose&&e("Individual word score average:",a),l=this.mainSeacher.search(t),this.options.verbose&&e("Full text score:",l.score),p=l.score,void 0!==a&&(p=(p+a)/2),this.options.verbose&&e("Average",p),(y||l.isMatch)&&(h=this.resultMap[o],h?h.scores.push(p):(this.resultMap[o]={item:s,scores:[p]},this.results.push(this.resultMap[o])))}else if(i(t))for(v=0;v<t.length;v++)this._analyze(t[v],s,o)},s.prototype._computeScore=function(){var t,e,s,o,i,n=this.results;for(t=0;t<n.length;t++){for(s=0,o=n[t].scores,i=o.length,e=0;i>e;e++)s+=o[e];n[t].score=s/i}},s.prototype._sort=function(){var t=this.options;t.shouldSort&&(this.options.verbose&&e("Sorting...."),this.results.sort(t.sortFn))},s.prototype._format=function(){var t,s,o,i,n,r=this.options,h=r.getFn,a=[],p=this.results;for(this.options.verbose&&e("------------\n","Output:\n",p),i=r.id?function(t){p[t].item=h(p[t].item,r.id,[])[0]}:function(){},n=function(t){var e,s,o;if(r.include.length>0)for(e={item:p[t].item},s=0;s<r.include.length;s++)o=r.include[s],e[o]=p[t][o];else e=p[t].item;return e},s=0,o=p.length;o>s;s++)i(s),t=n(s),a.push(t);return a},n.defaultOptions={location:0,distance:100,threshold:.6,maxPatternLength:32},n.prototype._calculatePatternAlphabet=function(){var t={},e=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]|=1<<this.pattern.length-e-1;return t},n.prototype._bitapScore=function(t,e){var s=t/this.patternLen,o=Math.abs(this.options.location-e);return this.options.distance?s+o/this.options.distance:o?1:s},n.prototype.search=function(t){if(t=this.options.caseSensitive?t:t.toLowerCase(),this.pattern===t)return{isMatch:!0,score:0};var e,s,o,i,n,r,h,a,p,c=t.length,l=this.options.location,u=this.options.threshold,f=t.indexOf(this.pattern,l),d=this.patternLen+c,g=1,v=[];for(-1!=f&&(u=Math.min(this._bitapScore(0,f),u),f=t.lastIndexOf(this.pattern,l+this.patternLen),-1!=f&&(u=Math.min(this._bitapScore(0,f),u))),f=-1,e=0;e<this.patternLen;e++){for(o=0,i=d;i>o;)this._bitapScore(e,l+i)<=u?o=i:d=i,i=Math.floor((d-o)/2+o);for(d=i,n=Math.max(1,l-i+1),r=Math.min(l+i,c)+this.patternLen,h=Array(r+2),h[r+1]=(1<<e)-1,s=r;s>=n;s--)if(p=this.patternAlphabet[t.charAt(s-1)],h[s]=0===e?(h[s+1]<<1|1)&p:(h[s+1]<<1|1)&p|((a[s+1]|a[s])<<1|1)|a[s+1],h[s]&this.matchmask&&(g=this._bitapScore(e,s-1)||.001,u>=g)){if(u=g,f=s-1,v.push(f),!(f>l))break;n=Math.max(1,2*l-f)}if(this._bitapScore(e+1,l)>u)break;a=h}return{isMatch:f>=0,score:g}},"object"==typeof exports?module.exports=s:"function"==typeof define&&define.amd?define(function(){return s}):t.Fuse=s}(this);